// GENERATED BY SCHEMOCK - DO NOT EDIT
import { factory, primaryKey, nullable } from '@mswjs/data';
import { faker } from '@faker-js/faker';

faker.seed(Date.now());

export const db = factory({
  authUser: {
    id: primaryKey(faker.string.uuid),
    email: () => faker.internet.email(),
    encrypted_password: () => faker.lorem.word(),
    email_confirmed_at: nullable(() => faker.date.recent()),
    full_name: nullable(() => faker.person.fullName()),
    avatar_url: nullable(() => faker.internet.url()),
    createdAt: () => faker.date.past(),
    updatedAt: () => faker.date.recent(),
  },
  authSession: {
    id: primaryKey(faker.string.uuid),
    user_id: () => faker.string.uuid(),
    access_token: () => faker.string.uuid(),
    refresh_token: () => faker.string.uuid(),
    expires_at: () => faker.date.recent(),
    createdAt: () => faker.date.past(),
    updatedAt: () => faker.date.recent(),
  },
  profile: {
    id: primaryKey(faker.string.uuid),
    email: () => faker.internet.email(),
    full_name: nullable(() => faker.person.fullName()),
    avatar_url: nullable(() => faker.internet.url()),
    createdAt: () => faker.date.past(),
    updatedAt: () => faker.date.recent(),
  },
  organization: {
    id: primaryKey(faker.string.uuid),
    name: () => faker.company.name(),
    slug: () => faker.lorem.word(),
    logo: nullable(() => faker.internet.url()),
    industry: () => faker.helpers.arrayElement(['technology', 'healthcare', 'finance', 'retail', 'manufacturing', 'education', 'government', 'other']),
    company_size: () => faker.helpers.arrayElement(['1-10', '11-50', '51-200', '201-500', '501-1000', '1000+']),
    website: nullable(() => faker.internet.url()),
    billing_email: nullable(() => faker.internet.email()),
    owner_id: () => faker.string.uuid(),
    settings: () => JSON.stringify(({  })),
    createdAt: () => faker.date.past(),
    updatedAt: () => faker.date.recent(),
  },
  permission: {
    id: primaryKey(faker.string.uuid),
    key: () => faker.lorem.word(),
    name: () => faker.lorem.word(),
    description: () => faker.lorem.sentence(),
    organization_id: nullable(() => faker.string.uuid()),
    createdAt: () => faker.date.past(),
    updatedAt: () => faker.date.recent(),
  },
  permissionTemplate: {
    id: primaryKey(faker.string.uuid),
    name: () => faker.lorem.word(),
    description: () => faker.lorem.sentence(),
    organization_id: nullable(() => faker.string.uuid()),
    is_system: () => faker.datatype.boolean(),
    permissions: () => Array.from({ length: faker.number.int({ min: 1, max: 5 }) }, () => faker.lorem.word()),
    createdAt: () => faker.date.past(),
    updatedAt: () => faker.date.recent(),
  },
  project: {
    id: primaryKey(faker.string.uuid),
    name: () => faker.company.name(),
    description: nullable(() => faker.lorem.paragraph()),
    repo_url: nullable(() => faker.internet.url()),
    status: () => faker.helpers.arrayElement(['active', 'archived', 'draft']),
    owner_id: () => faker.string.uuid(),
    settings: nullable(() => JSON.stringify(({  }))),
    createdAt: () => faker.date.past(),
    updatedAt: () => faker.date.recent(),
  },
  userPermissionMap: {
    id: primaryKey(faker.string.uuid),
    user_id: () => faker.string.uuid(),
    organization_id: nullable(() => faker.string.uuid()),
    project_id: nullable(() => faker.string.uuid()),
    permissions: () => Array.from({ length: faker.number.int({ min: 1, max: 5 }) }, () => faker.lorem.word()),
    granted_by: () => faker.string.uuid(),
    granted_at: () => faker.date.recent(),
    expires_at: nullable(() => faker.date.recent()),
    reason: nullable(() => faker.lorem.sentence()),
    createdAt: () => faker.date.past(),
    updatedAt: () => faker.date.recent(),
  },
  environment: {
    id: primaryKey(faker.string.uuid),
    project_id: () => faker.string.uuid(),
    name: () => faker.helpers.arrayElement(['development', 'staging', 'uat', 'production']),
    url: nullable(() => faker.internet.url()),
    branch: () => faker.lorem.word(),
    variables: () => JSON.stringify(({  })),
    is_protected: () => faker.datatype.boolean(),
    createdAt: () => faker.date.past(),
    updatedAt: () => faker.date.recent(),
  },
  deployment: {
    id: primaryKey(faker.string.uuid),
    project_id: () => faker.string.uuid(),
    environment_id: () => faker.string.uuid(),
    commit_sha: () => faker.lorem.word(),
    commit_message: nullable(() => faker.lorem.sentence()),
    status: () => faker.helpers.arrayElement(['pending', 'building', 'deploying', 'success', 'failed', 'rolled_back']),
    deployed_by: () => faker.string.uuid(),
    logs: nullable(() => faker.lorem.word()),
    started_at: () => faker.date.recent(),
    completed_at: nullable(() => faker.date.recent()),
    createdAt: () => faker.date.past(),
    updatedAt: () => faker.date.recent(),
  },
  securityScan: {
    id: primaryKey(faker.string.uuid),
    project_id: () => faker.string.uuid(),
    scan_type: () => faker.helpers.arrayElement(['vulnerability', 'compliance', 'secrets', 'dependencies']),
    status: () => faker.helpers.arrayElement(['pending', 'running', 'completed', 'failed']),
    findings: () => JSON.stringify(({ critical: faker.number.float({ min: 0, max: 10, fractionDigits: 2 }), high: faker.number.float({ min: 0, max: 20, fractionDigits: 2 }), medium: faker.number.float({ min: 0, max: 30, fractionDigits: 2 }), low: faker.number.float({ min: 0, max: 50, fractionDigits: 2 }) })),
    summary: () => JSON.stringify(({  })),
    started_at: () => faker.date.recent(),
    completed_at: nullable(() => faker.date.recent()),
    createdAt: () => faker.date.past(),
    updatedAt: () => faker.date.recent(),
  },
  teamInvitation: {
    id: primaryKey(faker.string.uuid),
    organization_id: () => faker.string.uuid(),
    email: () => faker.internet.email(),
    invited_by: () => faker.string.uuid(),
    expires_at: () => faker.date.recent(),
    status: () => faker.helpers.arrayElement(['pending', 'accepted', 'expired', 'revoked']),
    createdAt: () => faker.date.past(),
    updatedAt: () => faker.date.recent(),
  },
  teamMember: {
    id: primaryKey(faker.string.uuid),
    organization_id: () => faker.string.uuid(),
    user_id: () => faker.string.uuid(),
    joined_at: () => faker.date.recent(),
    last_active_at: nullable(() => faker.date.recent()),
    invited_by: nullable(() => faker.string.uuid()),
    createdAt: () => faker.date.past(),
    updatedAt: () => faker.date.recent(),
  },
});

export type Database = typeof db;

// === localStorage Persistence ===

const STORAGE_KEY = 'schemock';

function isLocalStorageAvailable(): boolean {
  try {
    if (typeof window === 'undefined' || !window.localStorage) return false;
    const testKey = '__schemock_test__';
    window.localStorage.setItem(testKey, 'test');
    window.localStorage.removeItem(testKey);
    return true;
  } catch {
    return false;
  }
}

function restoreDates(record: Record<string, unknown>): Record<string, unknown> {
  const result = { ...record };
  for (const [key, value] of Object.entries(result)) {
    if (typeof value === 'string' && /^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}/.test(value)) {
      const date = new Date(value);
      if (!isNaN(date.getTime())) result[key] = date;
    }
  }
  return result;
}

function loadFromStorage(): void {
  if (!isLocalStorageAvailable()) return;

  try {
    const authUserData = window.localStorage.getItem(`${STORAGE_KEY}:authUser`);
    if (authUserData) {
      const records = JSON.parse(authUserData) as Record<string, unknown>[];
      for (const record of records) {
        const restored = restoreDates(record);
        db.authUser.create(restored as Parameters<typeof db.authUser.create>[0]);
      }
    }
    const authSessionData = window.localStorage.getItem(`${STORAGE_KEY}:authSession`);
    if (authSessionData) {
      const records = JSON.parse(authSessionData) as Record<string, unknown>[];
      for (const record of records) {
        const restored = restoreDates(record);
        db.authSession.create(restored as Parameters<typeof db.authSession.create>[0]);
      }
    }
    const profileData = window.localStorage.getItem(`${STORAGE_KEY}:profile`);
    if (profileData) {
      const records = JSON.parse(profileData) as Record<string, unknown>[];
      for (const record of records) {
        const restored = restoreDates(record);
        db.profile.create(restored as Parameters<typeof db.profile.create>[0]);
      }
    }
    const organizationData = window.localStorage.getItem(`${STORAGE_KEY}:organization`);
    if (organizationData) {
      const records = JSON.parse(organizationData) as Record<string, unknown>[];
      for (const record of records) {
        const restored = restoreDates(record);
        db.organization.create(restored as Parameters<typeof db.organization.create>[0]);
      }
    }
    const permissionData = window.localStorage.getItem(`${STORAGE_KEY}:permission`);
    if (permissionData) {
      const records = JSON.parse(permissionData) as Record<string, unknown>[];
      for (const record of records) {
        const restored = restoreDates(record);
        db.permission.create(restored as Parameters<typeof db.permission.create>[0]);
      }
    }
    const permissionTemplateData = window.localStorage.getItem(`${STORAGE_KEY}:permissionTemplate`);
    if (permissionTemplateData) {
      const records = JSON.parse(permissionTemplateData) as Record<string, unknown>[];
      for (const record of records) {
        const restored = restoreDates(record);
        db.permissionTemplate.create(restored as Parameters<typeof db.permissionTemplate.create>[0]);
      }
    }
    const projectData = window.localStorage.getItem(`${STORAGE_KEY}:project`);
    if (projectData) {
      const records = JSON.parse(projectData) as Record<string, unknown>[];
      for (const record of records) {
        const restored = restoreDates(record);
        db.project.create(restored as Parameters<typeof db.project.create>[0]);
      }
    }
    const userPermissionMapData = window.localStorage.getItem(`${STORAGE_KEY}:userPermissionMap`);
    if (userPermissionMapData) {
      const records = JSON.parse(userPermissionMapData) as Record<string, unknown>[];
      for (const record of records) {
        const restored = restoreDates(record);
        db.userPermissionMap.create(restored as Parameters<typeof db.userPermissionMap.create>[0]);
      }
    }
    const environmentData = window.localStorage.getItem(`${STORAGE_KEY}:environment`);
    if (environmentData) {
      const records = JSON.parse(environmentData) as Record<string, unknown>[];
      for (const record of records) {
        const restored = restoreDates(record);
        db.environment.create(restored as Parameters<typeof db.environment.create>[0]);
      }
    }
    const deploymentData = window.localStorage.getItem(`${STORAGE_KEY}:deployment`);
    if (deploymentData) {
      const records = JSON.parse(deploymentData) as Record<string, unknown>[];
      for (const record of records) {
        const restored = restoreDates(record);
        db.deployment.create(restored as Parameters<typeof db.deployment.create>[0]);
      }
    }
    const securityScanData = window.localStorage.getItem(`${STORAGE_KEY}:securityScan`);
    if (securityScanData) {
      const records = JSON.parse(securityScanData) as Record<string, unknown>[];
      for (const record of records) {
        const restored = restoreDates(record);
        db.securityScan.create(restored as Parameters<typeof db.securityScan.create>[0]);
      }
    }
    const teamInvitationData = window.localStorage.getItem(`${STORAGE_KEY}:teamInvitation`);
    if (teamInvitationData) {
      const records = JSON.parse(teamInvitationData) as Record<string, unknown>[];
      for (const record of records) {
        const restored = restoreDates(record);
        db.teamInvitation.create(restored as Parameters<typeof db.teamInvitation.create>[0]);
      }
    }
    const teamMemberData = window.localStorage.getItem(`${STORAGE_KEY}:teamMember`);
    if (teamMemberData) {
      const records = JSON.parse(teamMemberData) as Record<string, unknown>[];
      for (const record of records) {
        const restored = restoreDates(record);
        db.teamMember.create(restored as Parameters<typeof db.teamMember.create>[0]);
      }
    }
  } catch (error) {
    console.warn('[Schemock] Error loading from localStorage:', error);
  }
}

function saveToStorage(): void {
  if (!isLocalStorageAvailable()) return;

  try {
    window.localStorage.setItem(`${STORAGE_KEY}:authUser`, JSON.stringify(db.authUser.getAll()));
    window.localStorage.setItem(`${STORAGE_KEY}:authSession`, JSON.stringify(db.authSession.getAll()));
    window.localStorage.setItem(`${STORAGE_KEY}:profile`, JSON.stringify(db.profile.getAll()));
    window.localStorage.setItem(`${STORAGE_KEY}:organization`, JSON.stringify(db.organization.getAll()));
    window.localStorage.setItem(`${STORAGE_KEY}:permission`, JSON.stringify(db.permission.getAll()));
    window.localStorage.setItem(`${STORAGE_KEY}:permissionTemplate`, JSON.stringify(db.permissionTemplate.getAll()));
    window.localStorage.setItem(`${STORAGE_KEY}:project`, JSON.stringify(db.project.getAll()));
    window.localStorage.setItem(`${STORAGE_KEY}:userPermissionMap`, JSON.stringify(db.userPermissionMap.getAll()));
    window.localStorage.setItem(`${STORAGE_KEY}:environment`, JSON.stringify(db.environment.getAll()));
    window.localStorage.setItem(`${STORAGE_KEY}:deployment`, JSON.stringify(db.deployment.getAll()));
    window.localStorage.setItem(`${STORAGE_KEY}:securityScan`, JSON.stringify(db.securityScan.getAll()));
    window.localStorage.setItem(`${STORAGE_KEY}:teamInvitation`, JSON.stringify(db.teamInvitation.getAll()));
    window.localStorage.setItem(`${STORAGE_KEY}:teamMember`, JSON.stringify(db.teamMember.getAll()));
  } catch (error) {
    console.warn('[Schemock] Error saving to localStorage:', error);
  }
}

function clearStorage(): void {
  if (!isLocalStorageAvailable()) return;
  window.localStorage.removeItem(`${STORAGE_KEY}:authUser`);
  window.localStorage.removeItem(`${STORAGE_KEY}:authSession`);
  window.localStorage.removeItem(`${STORAGE_KEY}:profile`);
  window.localStorage.removeItem(`${STORAGE_KEY}:organization`);
  window.localStorage.removeItem(`${STORAGE_KEY}:permission`);
  window.localStorage.removeItem(`${STORAGE_KEY}:permissionTemplate`);
  window.localStorage.removeItem(`${STORAGE_KEY}:project`);
  window.localStorage.removeItem(`${STORAGE_KEY}:userPermissionMap`);
  window.localStorage.removeItem(`${STORAGE_KEY}:environment`);
  window.localStorage.removeItem(`${STORAGE_KEY}:deployment`);
  window.localStorage.removeItem(`${STORAGE_KEY}:securityScan`);
  window.localStorage.removeItem(`${STORAGE_KEY}:teamInvitation`);
  window.localStorage.removeItem(`${STORAGE_KEY}:teamMember`);
}

let saveTimer: ReturnType<typeof setTimeout> | null = null;

function scheduleSave(): void {
  if (saveTimer) clearTimeout(saveTimer);
  saveTimer = setTimeout(() => {
    saveToStorage();
    saveTimer = null;
  }, 100);
}

// Wrap database methods to persist on changes
function wrapDbMethods(): void {
  const origauthUserCreate = db.authUser.create.bind(db.authUser);
  const origauthUserUpdate = db.authUser.update.bind(db.authUser);
  const origauthUserDelete = db.authUser.delete.bind(db.authUser);

  db.authUser.create = (data) => {
    const result = origauthUserCreate(data);
    scheduleSave();
    return result;
  };

  db.authUser.update = (query) => {
    const result = origauthUserUpdate(query);
    scheduleSave();
    return result;
  };

  db.authUser.delete = (query) => {
    const result = origauthUserDelete(query);
    scheduleSave();
    return result;
  };

  const origauthSessionCreate = db.authSession.create.bind(db.authSession);
  const origauthSessionUpdate = db.authSession.update.bind(db.authSession);
  const origauthSessionDelete = db.authSession.delete.bind(db.authSession);

  db.authSession.create = (data) => {
    const result = origauthSessionCreate(data);
    scheduleSave();
    return result;
  };

  db.authSession.update = (query) => {
    const result = origauthSessionUpdate(query);
    scheduleSave();
    return result;
  };

  db.authSession.delete = (query) => {
    const result = origauthSessionDelete(query);
    scheduleSave();
    return result;
  };

  const origprofileCreate = db.profile.create.bind(db.profile);
  const origprofileUpdate = db.profile.update.bind(db.profile);
  const origprofileDelete = db.profile.delete.bind(db.profile);

  db.profile.create = (data) => {
    const result = origprofileCreate(data);
    scheduleSave();
    return result;
  };

  db.profile.update = (query) => {
    const result = origprofileUpdate(query);
    scheduleSave();
    return result;
  };

  db.profile.delete = (query) => {
    const result = origprofileDelete(query);
    scheduleSave();
    return result;
  };

  const origorganizationCreate = db.organization.create.bind(db.organization);
  const origorganizationUpdate = db.organization.update.bind(db.organization);
  const origorganizationDelete = db.organization.delete.bind(db.organization);

  db.organization.create = (data) => {
    const result = origorganizationCreate(data);
    scheduleSave();
    return result;
  };

  db.organization.update = (query) => {
    const result = origorganizationUpdate(query);
    scheduleSave();
    return result;
  };

  db.organization.delete = (query) => {
    const result = origorganizationDelete(query);
    scheduleSave();
    return result;
  };

  const origpermissionCreate = db.permission.create.bind(db.permission);
  const origpermissionUpdate = db.permission.update.bind(db.permission);
  const origpermissionDelete = db.permission.delete.bind(db.permission);

  db.permission.create = (data) => {
    const result = origpermissionCreate(data);
    scheduleSave();
    return result;
  };

  db.permission.update = (query) => {
    const result = origpermissionUpdate(query);
    scheduleSave();
    return result;
  };

  db.permission.delete = (query) => {
    const result = origpermissionDelete(query);
    scheduleSave();
    return result;
  };

  const origpermissionTemplateCreate = db.permissionTemplate.create.bind(db.permissionTemplate);
  const origpermissionTemplateUpdate = db.permissionTemplate.update.bind(db.permissionTemplate);
  const origpermissionTemplateDelete = db.permissionTemplate.delete.bind(db.permissionTemplate);

  db.permissionTemplate.create = (data) => {
    const result = origpermissionTemplateCreate(data);
    scheduleSave();
    return result;
  };

  db.permissionTemplate.update = (query) => {
    const result = origpermissionTemplateUpdate(query);
    scheduleSave();
    return result;
  };

  db.permissionTemplate.delete = (query) => {
    const result = origpermissionTemplateDelete(query);
    scheduleSave();
    return result;
  };

  const origprojectCreate = db.project.create.bind(db.project);
  const origprojectUpdate = db.project.update.bind(db.project);
  const origprojectDelete = db.project.delete.bind(db.project);

  db.project.create = (data) => {
    const result = origprojectCreate(data);
    scheduleSave();
    return result;
  };

  db.project.update = (query) => {
    const result = origprojectUpdate(query);
    scheduleSave();
    return result;
  };

  db.project.delete = (query) => {
    const result = origprojectDelete(query);
    scheduleSave();
    return result;
  };

  const origuserPermissionMapCreate = db.userPermissionMap.create.bind(db.userPermissionMap);
  const origuserPermissionMapUpdate = db.userPermissionMap.update.bind(db.userPermissionMap);
  const origuserPermissionMapDelete = db.userPermissionMap.delete.bind(db.userPermissionMap);

  db.userPermissionMap.create = (data) => {
    const result = origuserPermissionMapCreate(data);
    scheduleSave();
    return result;
  };

  db.userPermissionMap.update = (query) => {
    const result = origuserPermissionMapUpdate(query);
    scheduleSave();
    return result;
  };

  db.userPermissionMap.delete = (query) => {
    const result = origuserPermissionMapDelete(query);
    scheduleSave();
    return result;
  };

  const origenvironmentCreate = db.environment.create.bind(db.environment);
  const origenvironmentUpdate = db.environment.update.bind(db.environment);
  const origenvironmentDelete = db.environment.delete.bind(db.environment);

  db.environment.create = (data) => {
    const result = origenvironmentCreate(data);
    scheduleSave();
    return result;
  };

  db.environment.update = (query) => {
    const result = origenvironmentUpdate(query);
    scheduleSave();
    return result;
  };

  db.environment.delete = (query) => {
    const result = origenvironmentDelete(query);
    scheduleSave();
    return result;
  };

  const origdeploymentCreate = db.deployment.create.bind(db.deployment);
  const origdeploymentUpdate = db.deployment.update.bind(db.deployment);
  const origdeploymentDelete = db.deployment.delete.bind(db.deployment);

  db.deployment.create = (data) => {
    const result = origdeploymentCreate(data);
    scheduleSave();
    return result;
  };

  db.deployment.update = (query) => {
    const result = origdeploymentUpdate(query);
    scheduleSave();
    return result;
  };

  db.deployment.delete = (query) => {
    const result = origdeploymentDelete(query);
    scheduleSave();
    return result;
  };

  const origsecurityScanCreate = db.securityScan.create.bind(db.securityScan);
  const origsecurityScanUpdate = db.securityScan.update.bind(db.securityScan);
  const origsecurityScanDelete = db.securityScan.delete.bind(db.securityScan);

  db.securityScan.create = (data) => {
    const result = origsecurityScanCreate(data);
    scheduleSave();
    return result;
  };

  db.securityScan.update = (query) => {
    const result = origsecurityScanUpdate(query);
    scheduleSave();
    return result;
  };

  db.securityScan.delete = (query) => {
    const result = origsecurityScanDelete(query);
    scheduleSave();
    return result;
  };

  const origteamInvitationCreate = db.teamInvitation.create.bind(db.teamInvitation);
  const origteamInvitationUpdate = db.teamInvitation.update.bind(db.teamInvitation);
  const origteamInvitationDelete = db.teamInvitation.delete.bind(db.teamInvitation);

  db.teamInvitation.create = (data) => {
    const result = origteamInvitationCreate(data);
    scheduleSave();
    return result;
  };

  db.teamInvitation.update = (query) => {
    const result = origteamInvitationUpdate(query);
    scheduleSave();
    return result;
  };

  db.teamInvitation.delete = (query) => {
    const result = origteamInvitationDelete(query);
    scheduleSave();
    return result;
  };

  const origteamMemberCreate = db.teamMember.create.bind(db.teamMember);
  const origteamMemberUpdate = db.teamMember.update.bind(db.teamMember);
  const origteamMemberDelete = db.teamMember.delete.bind(db.teamMember);

  db.teamMember.create = (data) => {
    const result = origteamMemberCreate(data);
    scheduleSave();
    return result;
  };

  db.teamMember.update = (query) => {
    const result = origteamMemberUpdate(query);
    scheduleSave();
    return result;
  };

  db.teamMember.delete = (query) => {
    const result = origteamMemberDelete(query);
    scheduleSave();
    return result;
  };

}

// Persistence utilities
export const persistence = {
  save: saveToStorage,
  load: loadFromStorage,
  clear: clearStorage,
  /** Force immediate save (bypass debounce) */
  flush: () => {
    if (saveTimer) {
      clearTimeout(saveTimer);
      saveTimer = null;
    }
    saveToStorage();
  },
};

// Initialize: load data and wrap methods
loadFromStorage();
wrapDbMethods();